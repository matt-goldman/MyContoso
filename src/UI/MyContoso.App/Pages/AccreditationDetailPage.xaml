<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:fs="clr-namespace:FlagstoneUI.Core.Controls;assembly=FlagstoneUI.Core"
             xmlns:vm="clr-namespace:MyContoso.App.ViewModels"
             xmlns:lucide="clr-namespace:Plugin.Maui.Lucide.Controls;assembly=Plugin.Maui.Lucide"
             xmlns:li="clr-namespace:Plugin.Maui.Lucide;assembly=Plugin.Maui.Lucide"
             x:Class="MyContoso.App.Pages.AccreditationDetailPage"
             x:DataType="vm:AccreditationDetailViewModel"
             BackgroundColor="{DynamicResource Color.Background}">

    <ScrollView>
        <VerticalStackLayout Padding="16,0" Spacing="2">
            <!-- Main Card -->
            <fs:FsCard Style="{DynamicResource ElevatedCard}"
                       Elevation="1">
                <VerticalStackLayout Spacing="16">
                    <!-- Header with Icon -->
                    <Border WidthRequest="56"
                            HeightRequest="56"
                            StrokeShape="RoundRectangle 12"
                            HorizontalOptions="Start"
                            Padding="0"
                            BackgroundColor="{Binding StatusBackgroundColor}"
                            Stroke="Transparent">
                        <lucide:Icon Name="{Binding StatusIcon}"
                                     Size="32"
                                     Color="{Binding StatusIconColor}"
                                     HorizontalOptions="Center"
                                     VerticalOptions="Center" />
                    </Border>

                    <!-- Status Badge -->
                    <Border Padding="12,4"
                            BackgroundColor="{Binding StatusBadgeColor}"
                            StrokeThickness="0"
                            HorizontalOptions="Start">
                        <Border.StrokeShape>
                            <RoundRectangle CornerRadius="12" />
                        </Border.StrokeShape>
                        <Label Text="{Binding Accreditation.Status}"
                               TextColor="{Binding StatusBadgeTextColor}"
                               FontSize="12"
                               FontAttributes="Bold" />
                    </Border>

                    <Label Text="{Binding Accreditation.Name}"
                           TextColor="{DynamicResource Color.OnSurface}"
                           FontSize="20"
                           FontAttributes="Bold"
                           FontFamily="{OnPlatform iOS='OpenSansBold'}"
                           LineBreakMode="WordWrap" />


                    <!-- Description -->
                    <Label Text="{Binding Accreditation.Description}"
                           TextColor="{DynamicResource Color.OnSurfaceVariant}"
                           FontSize="14"
                           LineHeight="1.4" />

                    <!-- Separator -->
                    <BoxView HeightRequest="1"
                             BackgroundColor="{DynamicResource Color.OutlineVariant}" />

                    <Border StrokeThickness="1"
                            Stroke="{StaticResource Gray400}"
                            StrokeShape="RoundRectangle 8"
                            VerticalOptions="Center"
                            HorizontalOptions="Start"
                            Padding="5,2">
                        <Label Text="{Binding Accreditation.Category, StringFormat='{0} Accreditation'}"
                               FontSize="10"/>
                    </Border>
                </VerticalStackLayout>
            </fs:FsCard>

            <!-- Expiry Information Card -->
            <fs:FsCard Style="{DynamicResource ElevatedCard}"
                       Elevation="1"
                       IsVisible="{Binding Accreditation.ExpiryDate, Converter={StaticResource IsNotNullConverter}}">
                <Grid ColumnDefinitions="Auto,*"
                      ColumnSpacing="12"
                      Padding="16">
                    <Border Grid.Column="0"
                           WidthRequest="40"
                           HeightRequest="40"
                           StrokeShape="RoundRectangle 8"
                           Padding="0"
                           BackgroundColor="{DynamicResource Color.PrimaryContainer}"
                           Stroke="Transparent">
                        <Label Text="{DynamicResource Calendar}"
                               FontFamily="lucide"
                               TextColor="{DynamicResource Color.Primary}"
                               FontSize="20"
                               HorizontalOptions="Center"
                               VerticalOptions="Center" />
                    </Border>

                    <VerticalStackLayout Grid.Column="1" VerticalOptions="Center" Spacing="2">
                        <Label Text="Expiry Date"
                               TextColor="{DynamicResource Color.OnSurfaceVariant}"
                               FontSize="12" />
                        <Label Text="{Binding Accreditation.ExpiryDate, StringFormat='{0:MMMM dd, yyyy}'}"
                               TextColor="{DynamicResource Color.OnSurface}"
                               FontSize="16"
                               FontAttributes="Bold" />
                        <Label Text="{Binding ExpiryComment}"
                               TextColor="{DynamicResource Color.OnSurfaceVariant}"
                               FontSize="12" />
                    </VerticalStackLayout>
                </Grid>
            </fs:FsCard>

            <!-- Warning Card for Expiring Soon -->
            <fs:FsCard BackgroundColor="{DynamicResource Color.SecondaryContainer}"
                       IsVisible="{Binding IsExpiringSoon}">
                <fs:FsCard.Triggers>
                    <DataTrigger TargetType="fs:FsCard" Binding="{Binding IsExpired}" Value="true">
                        <Setter Property="BackgroundColor" Value="#FEE2E2" />
                    </DataTrigger>
                </fs:FsCard.Triggers>
                <Grid ColumnDefinitions="Auto,*"
                      ColumnSpacing="12"
                      Padding="16">
                    <lucide:Icon Name="{x:Static li:Icons.CircleAlert}"
                                 Grid.Column="0"
                                 VerticalOptions="Start"
                                 Margin="0,2,0,0"
                                 Size="20"
                                 Color="{DynamicResource Color.OnSecondaryContainer}">
                        <lucide:Icon.Triggers>
                            <DataTrigger TargetType="lucide:Icon" Binding="{Binding IsExpired}" Value="True">
                                <Setter Property="Color" Value="#EF4444" />
                            </DataTrigger>
                        </lucide:Icon.Triggers>
                    </lucide:Icon>
                    <VerticalStackLayout Grid.Column="1" Spacing="4">
                        <Label Text="Renewal Reminder"
                               TextColor="{DynamicResource Color.OnSecondaryContainer}"
                               FontSize="14"
                               FontAttributes="Bold">
                            <Label.Triggers>
                                <DataTrigger TargetType="Label" Binding="{Binding IsExpired}" Value="true">
                                    <Setter Property="TextColor" Value="#EF4444" />
                                </DataTrigger>
                            </Label.Triggers>
                        </Label>
                        <Label Text="This accreditation is expiring soon. Please contact HR or the issuing organization to begin the renewal process."
                               TextColor="{DynamicResource Color.OnSecondaryContainer}"
                               FontSize="12"
                               LineHeight="1.3">
                            <Label.Triggers>
                                <DataTrigger TargetType="Label" Binding="{Binding IsExpired}" Value="True">
                                    <Setter Property="Text" Value="This accreditation has expired. Please contact HR or the issuing organization to begin the renewal process." />
                                    <Setter Property="TextColor" Value="#EF4444" />
                                </DataTrigger>
                            </Label.Triggers>
                        </Label>
                    </VerticalStackLayout>
                </Grid>
            </fs:FsCard>

            <!-- Action Buttons -->
            <VerticalStackLayout Spacing="12"
                                 Padding="16">
                <fs:FsButton Text="Renew Accreditation"
                             CornerRadius="12"
                             Background="{DynamicResource Color.Primary}"
                             IsVisible="{Binding IsExpiringSoon}"
                             ImageSource="{FontImageSource FontFamily=lucide, Glyph={DynamicResource Repeat2}}"/>

                <fs:FsButton Text="Share Credential"
                             CornerRadius="12"
                             Style="{DynamicResource OutlinedButton}"
                             TextColor="Gray"
                             IsVisible="{Binding IsShareable}"
                             ImageSource="{FontImageSource FontFamily=lucide, Glyph={DynamicResource Share2}, Color=Gray}"/>
            </VerticalStackLayout>
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>
