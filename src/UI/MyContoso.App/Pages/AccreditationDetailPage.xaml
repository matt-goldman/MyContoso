<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:fs="clr-namespace:FlagstoneUI.Core.Controls;assembly=FlagstoneUI.Core"
             xmlns:vm="clr-namespace:MyContoso.App.ViewModels"
             x:Class="MyContoso.App.Pages.AccreditationDetailPage"
             x:DataType="vm:AccreditationDetailViewModel"
             BackgroundColor="{DynamicResource Color.Background}">

    <ScrollView>
        <VerticalStackLayout Padding="16" Spacing="16">
            <!-- Main Card -->
            <fs:FsCard Style="{DynamicResource ElevatedCard}"
                       Elevation="1">
                <VerticalStackLayout Spacing="16">
                    <!-- Header with Icon -->
                    <Border WidthRequest="56"
                            HeightRequest="56"
                            StrokeShape="RoundRectangle 12"
                            HorizontalOptions="Start"
                            Padding="0"
                            BackgroundColor="{Binding Accreditation.Status, Converter={StaticResource AccreditationColorConverter}, ConverterParameter=Background}"
                            Stroke="Transparent">
                        <Label Text="{DynamicResource Award}"
                               FontFamily="lucide"
                               TextColor="{Binding Accreditation.Status, Converter={StaticResource AccreditationColorConverter}}"
                               FontSize="28"
                               HorizontalOptions="Center"
                               VerticalOptions="Center" />
                    </Border>
                    
                    <!-- Status Badge -->
                    <Border Padding="12,4"
                            BackgroundColor="{Binding Accreditation.Status, Converter={StaticResource AccreditationColorConverter}, ConverterParameter=Badge}"
                            StrokeThickness="0"
                            HorizontalOptions="Start">
                        <Border.StrokeShape>
                            <RoundRectangle CornerRadius="12" />
                        </Border.StrokeShape>
                        <Label Text="{Binding Accreditation.Status}"
                               TextColor="{Binding Accreditation.Status, Converter={StaticResource AccreditationColorConverter}, ConverterParameter=BadgeText}"
                               FontSize="12"
                               FontAttributes="Bold" />
                    </Border>
                            
                    <Label Text="{Binding Accreditation.Name}"
                           TextColor="{DynamicResource Color.OnSurface}"
                           FontSize="20"
                           FontAttributes="Bold"
                           FontFamily="{OnPlatform iOS='OpenSansBold'}"
                           LineBreakMode="WordWrap" />


                    <!-- Description -->
                    <Label Text="{Binding Accreditation.Description}"
                           TextColor="{DynamicResource Color.OnSurfaceVariant}"
                           FontSize="14"
                           LineHeight="1.4" />
                    
                    <!-- Separator -->
                    <BoxView HeightRequest="1"
                             BackgroundColor="{DynamicResource Color.OutlineVariant}" />
                    
                    <Border StrokeThickness="1"
                            Stroke="{StaticResource Gray400}"
                            StrokeShape="RoundRectangle 8"
                            VerticalOptions="Center"
                            HorizontalOptions="Start"
                            Padding="5,2">
                        <Label TextColor="{StaticResource Gray600}"
                               Text="{Binding Accreditation.Category, StringFormat='{0} Accreditation'}"
                               FontSize="10"/>
                    </Border>
                </VerticalStackLayout>
            </fs:FsCard>

            <!-- Expiry Information Card -->
            <fs:FsCard Style="{DynamicResource ElevatedCard}"
                       Elevation="1"
                       IsVisible="{Binding Accreditation.ExpiryDate, Converter={StaticResource IsNotNullConverter}}">
                <Grid ColumnDefinitions="Auto,*" ColumnSpacing="12">
                    <Border Grid.Column="0"
                           WidthRequest="40"
                           HeightRequest="40"
                           StrokeShape="RoundRectangle 8"
                           Padding="0"
                           BackgroundColor="{DynamicResource Color.PrimaryContainer}"
                           Stroke="Transparent">
                        <Label Text="{DynamicResource Calendar}"
                               FontFamily="lucide"
                               TextColor="{DynamicResource Color.Primary}"
                               FontSize="20"
                               HorizontalOptions="Center"
                               VerticalOptions="Center" />
                    </Border>

                    <VerticalStackLayout Grid.Column="1" VerticalOptions="Center" Spacing="2">
                        <Label Text="Expiry Date"
                               TextColor="{DynamicResource Color.OnSurfaceVariant}"
                               FontSize="12" />
                        <Label Text="{Binding Accreditation.ExpiryDate, StringFormat='{0:MMMM dd, yyyy}'}"
                               TextColor="{DynamicResource Color.OnSurface}"
                               FontSize="16"
                               FontAttributes="Bold" />
                        <Label Text="{Binding DaysUntilExpiry}"
                               TextColor="{DynamicResource Color.OnSurfaceVariant}"
                               FontSize="12" />
                    </VerticalStackLayout>
                </Grid>
            </fs:FsCard>

            <!-- Warning Card for Expiring Soon -->
            <fs:FsCard BackgroundColor="{DynamicResource Color.SecondaryContainer}"
                       IsVisible="{Binding IsExpiringSoon}">
                <Grid ColumnDefinitions="Auto,*" ColumnSpacing="12">
                    <Label Grid.Column="0"
                           Text="{DynamicResource AlertCircle}"
                           FontFamily="lucide"
                           TextColor="{DynamicResource Color.Secondary}"
                           FontSize="20"
                           VerticalOptions="Start"
                           Margin="0,2,0,0" />
                    <VerticalStackLayout Grid.Column="1" Spacing="4">
                        <Label Text="Renewal Reminder"
                               TextColor="{DynamicResource Color.OnSecondaryContainer}"
                               FontSize="14"
                               FontAttributes="Bold" />
                        <Label Text="This accreditation is expiring soon. Please contact HR or the issuing organization to begin the renewal process."
                               TextColor="{DynamicResource Color.OnSecondaryContainer}"
                               FontSize="12"
                               LineHeight="1.3" />
                    </VerticalStackLayout>
                </Grid>
            </fs:FsCard>

            <!-- Action Buttons -->
            <VerticalStackLayout Spacing="12">
                <fs:FsButton Text="Renew Accreditation"
                             Style="{DynamicResource OutlinedButton}"
                             IsVisible="{Binding IsExpiringSoon}" />

                <fs:FsButton Text="View Certificate"
                             Style="{DynamicResource OutlinedButton}" />
            </VerticalStackLayout>
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>
