<?xml version="1.0" encoding="utf-8"?>
<ContentView xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:fs="clr-namespace:FlagstoneUI.Core.Controls;assembly=FlagstoneUI.Core"
             xmlns:mct="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             xmlns:vm="clr-namespace:MyContoso.App.ViewModels"
             xmlns:lucide="clr-namespace:Plugin.Maui.Lucide.Controls;assembly=Plugin.Maui.Lucide"
             xmlns:models="clr-namespace:MyContoso.App.Models"
             x:DataType="models:CompanyUpdate"
             x:Class="MyContoso.App.Controls.CompanyUpdateCard">
    <fs:FsCard Style="{DynamicResource ElevatedCard}"
               Elevation="2">
        <fs:FsCard.GestureRecognizers>
            <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type vm:CompanyFeedViewModel}}, Path=ViewUpdateCommand}"
                                CommandParameter="{Binding .}" />
        </fs:FsCard.GestureRecognizers>

        <VerticalStackLayout Spacing="5">
            <!-- Author Row with Avatar -->
            <Grid ColumnDefinitions="40,*" ColumnSpacing="12">
                <!-- Avatar Circle with Author Initials -->
                <mct:AvatarView Grid.Column="0"
                                WidthRequest="40"
                                HeightRequest="40"
                                CornerRadius="20"
                                Padding="0"
                                BackgroundColor="{DynamicResource Color.Primary}"
                                BorderColor="Transparent"
                                Text="{Binding AuthorInitials}"
                                ImageSource="{Binding AuthorAvatarUrl}"
                                TextColor="{DynamicResource Color.OnPrimary}"
                                FontSize="14"
                                FontAttributes="Bold"
                                HorizontalOptions="Center"
                                VerticalOptions="Center" />

                <!-- Author Info -->
                <VerticalStackLayout Grid.Column="1"
                                    VerticalOptions="Center"
                                    Spacing="2">
                    <Label Text="{Binding AuthorName}"
                           TextColor="{DynamicResource Color.OnSurface}"
                           FontSize="14"
                           FontAttributes="Bold"
                           FontFamily="{OnPlatform iOS='OpenSansBold'}"
                           LineBreakMode="TailTruncation" />
                    <Label Text="{Binding AuthorRole}"
                           TextColor="{DynamicResource Color.OnSurfaceVariant}"
                           FontSize="Small" />
                    <Label Text="{Binding PublishedDate, StringFormat='{0:MMM dd, yyyy}'}"
                           TextColor="{DynamicResource Color.OnSurfaceVariant}"
                           FontSize="Micro" />
                </VerticalStackLayout>
            </Grid>

            <!-- Content -->
            <VerticalStackLayout Spacing="8"
                                 Margin="0,25,0,10">
                <!-- TODO: Add semibold -->
                <Label Text="{Binding Title}"
                       TextColor="{DynamicResource Color.OnSurface}"
                       FontSize="18"
                       FontAttributes="Bold"
                       FontFamily="{OnPlatform iOS='OpenSansBold'}"
                       LineBreakMode="WordWrap" />

                <Label Text="{Binding Body}"
                       TextColor="{DynamicResource Color.OnSurfaceVariant}"
                       FontSize="14"
                       MaxLines="5"
                       LineBreakMode="TailTruncation"
                       LineHeight="1.2" />
            </VerticalStackLayout>

            <!-- Action Buttons -->
            <BoxView HeightRequest="1"
                     BackgroundColor="{DynamicResource Color.OutlineVariant}"
                     Margin="0,4,0,0" />

            <FlexLayout Direction="Row"
                        JustifyContent="SpaceBetween"
                        Padding="10,0"
                        Margin="0">
                <Border StrokeShape="RoundRectangle 15"
                        Margin="0"
                        Padding="4"
                        MinimumWidthRequest="80"
                        Stroke="Transparent"
                        BackgroundColor="{Binding IsLiked, Converter={StaticResource LikedToColorConverter}}">
                    <HorizontalStackLayout Spacing="4"
                                           Padding="0"
                                           HorizontalOptions="Center">
                        <lucide:Icon Name="{DynamicResource Heart}"
                                     Color="{Binding IsLiked, Converter={StaticResource IsLikedToTextColor}}"
                                     Margin="0"
                                     Padding="0"
                                     HorizontalOptions="Center"/>
                        <fs:FsButton Text="{Binding Likes}"
                                     Style="{DynamicResource TextButton}"
                                     TextColor="{Binding IsLiked, Converter={StaticResource IsLikedToTextColor}}"
                                     Padding="0"
                                     HeightRequest="20"
                                     HorizontalOptions="Center"/>
                    </HorizontalStackLayout>
                </Border>

                <HorizontalStackLayout Spacing="6"
                                       Padding="0"
                                       HorizontalOptions="Center">
                    <lucide:Icon Name="{DynamicResource MessageCircle}"
                                 Color="Black"
                                 Margin="0"
                                 HorizontalOptions="Center"/>
                    <fs:FsButton Text="{Binding Comments}"
                                 TextColor="Black"
                                 Style="{DynamicResource TextButton}"

                                 HeightRequest="20"
                                 Padding="0"
                                 HorizontalOptions="Center"
                                 Margin="0"/>
                </HorizontalStackLayout>

                <HorizontalStackLayout Spacing="5"
                                       Padding="0"
                                       HorizontalOptions="Center">
                    <lucide:Icon Name="{DynamicResource Share2}"
                                 Color="Black"
                                 Margin="0"
                                 HorizontalOptions="Center"/>
                    <fs:FsButton Text="Share"
                                 Style="{DynamicResource TextButton}"
                                 TextColor="Black"
                                 HeightRequest="20"
                                 Padding="0"
                                 Margin="0"
                                 HorizontalOptions="Center"/>
                </HorizontalStackLayout>
            </FlexLayout>
        </VerticalStackLayout>
    </fs:FsCard>
</ContentView>
